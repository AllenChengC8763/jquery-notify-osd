(function(e){"use strict";var t={text:"",icon:"",timeout:5,sticky:false,dismissable:false,click_through:true,buffer:40,opacity_max:.85,opacity_min:.2,spacing:20,visible_max:3};var n=function(e,t){return{x:e,y:t,lies_inside:function(e){return this.y>e.top&&this.y<e.bottom&&this.x>e.left&&this.x<e.right},min_distance_in:function(e){var t={top:Math.abs(this.y-e.top),right:Math.abs(this.x-e.right),bottom:Math.abs(this.y-e.bottom),left:Math.abs(this.x-e.left)};var n=t.left;if(t.top<n){n=t.top}if(t.right<n){n=t.right}if(t.bottom<n){n=t.bottom}return n},to_string:function(){return"x: "+this.x+" y: "+this.y}}};var r=function(e){var t={update:function(e){this.top=e.top;this.left=e.left;this.width=e.width;this.height=e.height;this.bottom=e.top+e.height;this.right=e.left+e.width},to_string:function(){return"t: "+this.top+" l: "+this.left+" h: "+this.height+" w: "+this.width}};t.update(e);return t};var i=function(t){var n=[];return{events:t,first:function(){return n[0]},last:function(){return n[n.length-1]},clear:function(){n.length=0},indexOf:function(t){return e.inArray(t,n)},enqueue:function(r){var i=this.last();n.push(r);if(i){i.below=r;r.above=i}t.enqueue&&e(document).trigger(t.enqueue)},extract:function(r){var i=n[r-1];var s=n[r+1];var o=n.splice(r,1)[0];if(i){i.below=s}if(s){s.above=i}t.extract&&e(document).trigger({type:t.extract,extracted:o});return o},dequeue:function(){return this.extract(0)},length:function(){return n.length}}};var s={visible:new i({enqueue:"notif_display",extract:"notif_removed"}),queued:new i({enqueue:"notif_created"})};var o=function(){if(s.visible.length()<t.visible_max&&s.queued.length()>0){var e=s.queued.dequeue();s.visible.enqueue(e)}};e(document).bind(s.queued.events.enqueue,o);e(document).bind(s.visible.events.enqueue,function(n){var r=s.visible.last();var i=r.above;var o=t.spacing;if(i){o+=i.offset().top+i.height()}e(r).css("top",o);r.display()});e(document).bind(s.visible.events.extract,function(e){var t=e.extracted;if(t.below!==undefined){t.reposition_below(function(){o()})}else{o()}t.remove()});var u=0;e.notify_osd={defaults:t,create:function(i){var o=e.extend({},t,i);var a,f,l;f=new r({});l=new r({});var c=e('<div class="notify-osd"><div><table><tr><td class="notify-osd-content">'+o.text+"</td></tr></table></div></div>").css({opacity:o.opacity_max}).hide();c.extend({opts:o,set_text:function(t){e(this).find(".notify-osd-content").html(t);return this},set_icon:function(t){if(t!==""){e(this).find("tr").prepend('<td class="notify-osd-icon"><img src="'+t+'" /></td>')}else{e(this).find(".notify-osd-icon").remove()}return this},set_dismissable:function(t){if(o.dismissable||o.sticky){e(this).children("div").append('<a href="#" class="notify-osd-dismiss" title="Dismiss">Ã—</a>');e(this).find(".notify-osd-dismiss").unbind("click").click(function(){c.dismiss()})}else{e(this).find(".notify-osd-dismiss").unbind("click").remove()}return this},set_click_through:function(t){var n=t?"none":"auto";e(".notify-osd").css("pointer-events",n);e(".notify-osd .notify-osd-dismiss").css("pointer-events","auto")},update_regions:function(){f.update({top:c.offset().top,left:c.offset().left,width:c.width(),height:c.height()});l.update({top:f.top-o.buffer,left:f.left-o.buffer,width:f.width+2*o.buffer,height:f.height+2*o.buffer})},display:function(){this.set_text(o.text).set_icon(o.icon).set_dismissable(o.dismissable);e(this).appendTo("body").fadeIn("fast",function(){c.update_regions();window.clearTimeout(c.timeout);c.timeout=!o.sticky&&o.timeout?window.setTimeout(function(){c.dismiss()},o.timeout*1e3):null;a=new n(0,0);c.set_click_through(o.click_through);e(document).mousemove(c.mousemove)});return this},translate:function(e,t,n){var r=c.offset().top-e.up;c.animate({top:r},"fast",function(){c.update_regions();u++;if(u===t){n()}})},reposition_below:function(e){var n=c.below;var r=0;u=0;while(n!==undefined){r++;n=n.below}var n=c.below;while(n!==undefined){n.translate({up:c.height()+t.spacing},r,e);n=n.below}},dismiss:function(){e(document).unbind("mousemove",c.mousemove);e(this).fadeOut("fast",function(){var e=s.visible.indexOf(c);if(e>=0){s.visible.extract(e)}})},mousemove:function(t){a.x=t.pageX-e("body").scrollLeft();a.y=t.pageY-e("body").scrollTop();var n;if(a.lies_inside(l)){var r=a.min_distance_in(l);if(a.lies_inside(f)){n=o.opacity_min}else{n=o.opacity_max-(o.opacity_max-o.opacity_min)*(r/o.buffer)}}else{n=o.opacity_max}c.css("opacity",n)}});s.queued.enqueue(c);return c},setup:function(n){t=e.extend({},t,n)},dismiss:function(){s.queued.clear();var e=s.visible.first();while(e!==undefined){e.dismiss();e=e.below}}}})(jQuery)
